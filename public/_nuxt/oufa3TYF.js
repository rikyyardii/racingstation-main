import{v as N,G as X,J as Y,r as h,l as ee,D as se,k as le,p as te,y as B,c as r,a as t,d as j,_ as ne,A as oe,h as J,z as d,B as m,E as T,F as V,f as M,t as c,o as v}from"./Birlwjyq.js";import{u as ae}from"./CQu4EZGb.js";import{a as U}from"./xsH4HHeE.js";import{D as b}from"./DOXiyJsP.js";const ie={class:"app-wrapper"},de={class:"container"},ue={class:"form-group"},re=["value"],me={class:"form-group"},ce=["value"],ve={key:0,class:"schedule-manager-panel"},pe={class:"schedule-header"},_e={class:"schedule-info"},fe={class:"schedule-inputs"},ge={class:"time-input"},he=["for"],be=["id","onUpdate:modelValue","onInput"],ye={class:"time-input"},ke=["for"],Se=["id","onUpdate:modelValue","onInput"],Te={key:0,class:"current-session-schedule"},Ue={class:"active-schedule-display"},$e={class:"schedule-item"},Ce={class:"schedule-value"},Ee={class:"schedule-item"},Ie={class:"schedule-value"},Oe={key:1,class:"debug-info"},xe={__name:"[id]",setup(Ae){const $=X(),y=Y(),z=h(!1),l=h({title:"",category:"",event:"",excerpt:"",link:"",link2:"",link3:"",link4:"",content:"",event_type:"",session_name:"",scheduled_enable_time:null,scheduled_disable_time:null,status:""}),f=h([]),g=h({}),C=h([]),W=ee(()=>!0),o=se({}),_=h([]),{API_URL:k}=le().public,q=async()=>{try{console.log("Fetching event categories and sessions from database...");const n=await U.get(`${k}/event-categories`);f.value=n.data,console.log("Event categories fetched:",f.value);for(const e of f.value)try{const s=await U.get(`${k}/sessions/category/${e.name}`);g.value[e.name]=s.data,console.log(`Sessions for ${e.name}:`,s.data)}catch(s){console.error(`Error fetching sessions for ${e.name}:`,s),g.value[e.name]=[]}console.log("All session options:",g.value)}catch(n){console.error("Error fetching categories and sessions:",n),f.value=[],g.value={}}},p=()=>{const n=l.value.event_type,e=f.value.find(s=>s.event_type_description===n);return e?e.name:"other"},w=n=>{if(!n)return"Belum diatur";try{return b.fromISO(n).setZone("Asia/Jakarta").toFormat("dd MMM yyyy, HH:mm")}catch(e){return console.error("Error formatting datetime:",e),n}},D=()=>{const n=p();console.log("Initializing session schedules for type:",n);const e=g.value[n]||[];o[n]||(o[n]={}),_.value=e.map(s=>(o[n][s.session_name]||(o[n][s.session_name]={session_name:s.session_name,startTime:null,endTime:null}),{session_name:s.session_name,session_order:s.session_order,startTime:o[n][s.session_name].startTime,endTime:o[n][s.session_name].endTime})),console.log("Initialized session schedules:",_.value),console.log("Session schedules object:",o[n])},L=(n,e,s)=>{const a=p();console.log(`Directly updating schedule for session ${n}, type ${e} with value ${s}`),o[a]||(o[a]={}),o[a][n]||(o[a][n]={session_name:n,startTime:null,endTime:null}),o[a][n][e]=s;const i=_.value.find(S=>S.session_name===n);i&&(i[e]=s),l.value.session_name===n&&(e==="startTime"?(l.value.scheduled_enable_time=s,console.log("Updated stream enable time:",s)):e==="endTime"&&(l.value.scheduled_disable_time=s,console.log("Updated stream disable time:",s))),console.log(`Updated session schedules for ${a}:`,o[a])},E=()=>{const n=l.value.session_name;if(!n)return;const e=p();if(console.log(`Updating schedule from selection: ${n}, type: ${e}`),o[e]||(o[e]={}),!o[e][n])console.log("Session not found in schedules, creating new entry"),o[e][n]={session_name:n,startTime:l.value.scheduled_enable_time,endTime:l.value.scheduled_disable_time};else{const s=o[e][n];console.log("Found session schedule:",s),s&&(l.value.scheduled_enable_time=s.startTime,l.value.scheduled_disable_time=s.endTime,console.log("Updated stream times from session schedule"))}},I=()=>{const n=p();console.log("Updating session options for type:",n),C.value=g.value[n]||[];const e=C.value.map(s=>s.session_name);e.includes(l.value.session_name)||(l.value.session_name=e[0]||"",E()),D()},F=n=>{if(!n)return null;try{const e=n.includes("T")?b.fromISO(n,{zone:"UTC"}):b.fromSQL(n,{zone:"UTC"});return e.isValid?e.setZone("Asia/Jakarta").toFormat("yyyy-MM-dd'T'HH:mm"):(console.error("Invalid UTC time format:",n),null)}catch(e){return console.error("Error converting UTC to WIB:",e),null}},H=async()=>{try{const n=y.params.slug||y.params.id;console.log("Fetching stream data for slug:",n);const{data:e}=await U.get(`${k}/streams/${n}`);console.log("Raw data:",e),e.scheduled_enable_time&&(e.scheduled_enable_time=F(e.scheduled_enable_time),console.log("Converted enable time:",e.scheduled_enable_time)),e.scheduled_disable_time&&(e.scheduled_disable_time=F(e.scheduled_disable_time),console.log("Converted disable time:",e.scheduled_disable_time)),l.value=e;let s=null;if(typeof e.session_schedules=="string")try{s=JSON.parse(e.session_schedules),console.log("Parsed session schedules from JSON string")}catch(a){console.error("Error parsing session_schedules JSON:",a)}else e.session_schedules&&typeof e.session_schedules=="object"&&(s=e.session_schedules,console.log("Using session_schedules object directly"));if(s&&(Object.entries(s).forEach(([a,i])=>{o[a]=i}),console.log("Loaded session schedules:",o)),I(),l.value.session_name&&(!l.value.scheduled_enable_time||!l.value.scheduled_disable_time)&&E(),l.value.session_name&&(l.value.scheduled_enable_time||l.value.scheduled_disable_time)){const a=p();o[a]||(o[a]={}),o[a][l.value.session_name]||(o[a][l.value.session_name]={session_name:l.value.session_name,startTime:null,endTime:null}),l.value.scheduled_enable_time&&(o[a][l.value.session_name].startTime=l.value.scheduled_enable_time),l.value.scheduled_disable_time&&(o[a][l.value.session_name].endTime=l.value.scheduled_disable_time),console.log(`Updated session '${l.value.session_name}' in schedules:`,o[a][l.value.session_name]),D()}}catch(n){console.error("Error fetching stream data:",n)}},P=()=>{if(confirm("Apakah Anda yakin ingin menghapus semua jadwal yang telah diatur?")){const n=p();o[n]&&Object.keys(o[n]).forEach(e=>{o[n][e].startTime=null,o[n][e].endTime=null}),_.value.forEach(e=>{e.startTime=null,e.endTime=null}),l.value.scheduled_enable_time=null,l.value.scheduled_disable_time=null,console.log("All schedules cleared")}},G=()=>{$.push("/rikya/components/Livestream")},Z=()=>{$.push("/rikya/components/Artikel")},Q=async()=>{var n,e,s,a;try{const i=y.params.slug||y.params.id;if(!i){alert("Slug tidak ditemukan!");return}const S=p(),R={...o};if(console.log("All session schedules to save:",R),l.value.session_name&&((n=o[S])!=null&&n[l.value.session_name])){const u=o[S][l.value.session_name];l.value.scheduled_enable_time=u.startTime,l.value.scheduled_disable_time=u.endTime}let O=null;if(l.value.scheduled_enable_time)try{const u=b.fromISO(l.value.scheduled_enable_time,{zone:"Asia/Jakarta"});u.isValid&&(O=u.toISO(),console.log("Converted enable time to ISO:",O))}catch(u){console.error("Error converting enable time:",u)}let x=null;if(l.value.scheduled_disable_time)try{const u=b.fromISO(l.value.scheduled_disable_time,{zone:"Asia/Jakarta"});u.isValid&&(x=u.toISO(),console.log("Converted disable time to ISO:",x))}catch(u){console.error("Error converting disable time:",u)}const A={...l.value,scheduled_enable_time:O,scheduled_disable_time:x,session_schedules:R};console.log("Sending payload:",A),console.log("Session schedules being saved:",A.session_schedules);const K=await U.put(`${k}/streams/${i}`,A);console.log("API response:",K.data),alert("Stream berhasil diperbarui!"),$.go(-1)}catch(i){console.error("Error updating stream:",((e=i.response)==null?void 0:e.data)||i.message),alert(`Gagal memperbarui stream: ${((a=(s=i.response)==null?void 0:s.data)==null?void 0:a.error)||i.message}`)}};return te(async()=>{await q(),await H()}),B(()=>l.value.event_type,I),B(()=>[l.value.scheduled_enable_time,l.value.scheduled_disable_time],([n,e])=>{if(l.value.session_name){const s=p();if(o[s]||(o[s]={}),o[s][l.value.session_name]||(o[s][l.value.session_name]={session_name:l.value.session_name,startTime:null,endTime:null}),n!==void 0){console.log(`Watched change to enable time: ${n}`),o[s][l.value.session_name].startTime=n;const a=_.value.find(i=>i.session_name===l.value.session_name);a&&(a.startTime=n)}if(e!==void 0){console.log(`Watched change to disable time: ${e}`),o[s][l.value.session_name].endTime=e;const a=_.value.find(i=>i.session_name===l.value.session_name);a&&(a.endTime=e)}}}),ae({title:"Edit Streaming",ogTitle:"Edit Streaming"}),(n,e)=>(v(),r("div",ie,[t("header",null,[t("div",{class:"header-content"},[t("h1",{class:"logo",onClick:Z,style:{cursor:"pointer"}},e[12]||(e[12]=[t("img",{src:ne,alt:"RacingStation Logo",class:"logo-image"},null,-1),j(" Dashboard ")]))])]),t("div",de,[e[32]||(e[32]=t("h2",{class:"black-text"},"Edit Livestream",-1)),t("form",{onSubmit:oe(Q,["prevent"])},[t("div",null,[e[13]||(e[13]=t("label",{for:"title"},"Title",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>l.value.title=s),id:"title",required:""},null,512),[[m,l.value.title]])]),t("div",ue,[e[15]||(e[15]=t("label",{for:"category"},"Category",-1)),d(t("select",{id:"category","onUpdate:modelValue":e[1]||(e[1]=s=>l.value.category=s),required:""},e[14]||(e[14]=[t("option",{value:"Motorsport"},"Motorsport",-1),t("option",{value:"Football"},"Football",-1),t("option",{value:"Basketball"},"Basketball",-1),t("option",{value:"Other"},"Other",-1)]),512),[[T,l.value.category]])]),t("div",null,[e[16]||(e[16]=t("label",{for:"event"},"Live Event",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>l.value.event=s),id:"event"},null,512),[[m,l.value.event]])]),t("div",null,[e[17]||(e[17]=t("label",{for:"event_type"},"Tipe Race Week",-1)),d(t("select",{id:"event_type","onUpdate:modelValue":e[3]||(e[3]=s=>l.value.event_type=s),onChange:I},[(v(!0),r(V,null,M(f.value,s=>(v(),r("option",{key:s.id,value:s.event_type_description},c(s.name.toUpperCase())+" - "+c(s.description),9,re))),128))],544),[[T,l.value.event_type]])]),t("div",null,[e[18]||(e[18]=t("label",{for:"excerpt"},"Excerpt",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>l.value.excerpt=s),id:"excerpt",required:""},null,512),[[m,l.value.excerpt]])]),t("div",null,[e[19]||(e[19]=t("label",{for:"link"},"Link 1",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>l.value.link=s),id:"link",required:""},null,512),[[m,l.value.link]])]),t("div",null,[e[20]||(e[20]=t("label",{for:"link2"},"Link 2",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[6]||(e[6]=s=>l.value.link2=s),id:"link2"},null,512),[[m,l.value.link2]])]),t("div",null,[e[21]||(e[21]=t("label",{for:"link3"},"Link 3",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[7]||(e[7]=s=>l.value.link3=s),id:"link3"},null,512),[[m,l.value.link3]])]),t("div",null,[e[22]||(e[22]=t("label",{for:"link4"},"Link 4",-1)),d(t("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=s=>l.value.link4=s),id:"link4"},null,512),[[m,l.value.link4]])]),t("div",null,[e[23]||(e[23]=t("label",{for:"content"},"Content",-1)),d(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=s=>l.value.content=s),id:"content",required:""},null,512),[[m,l.value.content]])]),t("div",me,[e[24]||(e[24]=t("label",{for:"session_name"},"Pilih Sesi",-1)),d(t("select",{id:"session_name","onUpdate:modelValue":e[10]||(e[10]=s=>l.value.session_name=s),onChange:E},[(v(!0),r(V,null,M(C.value,s=>(v(),r("option",{key:s.session_name,value:s.session_name},c(s.session_name),9,ce))),128))],544),[[T,l.value.session_name]])]),W.value?(v(),r("div",ve,[t("div",pe,[t("h3",null,c(l.value.event_type?"Jadwal Untuk Semua Sesi":"Jadwal Event"),1)]),t("p",_e,c(l.value.event_type?"Atur jadwal untuk semua sesi dalam race week. Jadwal akan otomatis diterapkan saat memilih sesi.":'Atur jadwal untuk event "Race WEC dan lainnya". Jadwal akan diterapkan ke sesi yang dipilih.'),1),(v(!0),r(V,null,M(_.value,(s,a)=>(v(),r("div",{key:a,class:"session-schedule"},[t("h4",null,c(s.session_name),1),t("div",fe,[t("div",ge,[t("label",{for:`start-${a}`},"Mulai",8,he),d(t("input",{type:"datetime-local",id:`start-${a}`,"onUpdate:modelValue":i=>s.startTime=i,onInput:i=>L(s.session_name,"startTime",s.startTime)},null,40,be),[[m,s.startTime]])]),t("div",ye,[t("label",{for:`end-${a}`},"Selesai",8,ke),d(t("input",{type:"datetime-local",id:`end-${a}`,"onUpdate:modelValue":i=>s.endTime=i,onInput:i=>L(s.session_name,"endTime",s.endTime)},null,40,Se),[[m,s.endTime]])])])]))),128)),t("button",{type:"button",onClick:P,class:"clear-schedule-btn"},e[25]||(e[25]=[t("i",{class:"fas fa-trash-alt"},null,-1),j(" Hapus Semua Jadwal")])),l.value.session_name?(v(),r("div",Te,[t("h3",null,"Jadwal Aktif Saat Ini ("+c(l.value.session_name)+")",1),t("div",Ue,[t("div",$e,[e[26]||(e[26]=t("span",{class:"schedule-label"},"Jadwal Enable:",-1)),t("span",Ce,c(w(l.value.scheduled_enable_time)),1)]),t("div",Ee,[e[27]||(e[27]=t("span",{class:"schedule-label"},"Jadwal Disable:",-1)),t("span",Ie,c(w(l.value.scheduled_disable_time)),1)])])])):J("",!0)])):J("",!0),t("div",null,[e[29]||(e[29]=t("label",{for:"status"},"Status",-1)),d(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>l.value.status=s),id:"status"},e[28]||(e[28]=[t("option",{value:"enable"},"Enable",-1),t("option",{value:"disable"},"Disable",-1)]),512),[[T,l.value.status]])]),z.value?(v(),r("div",Oe,[e[30]||(e[30]=t("h3",null,"Debug Info:",-1)),t("pre",null,c(JSON.stringify(o,null,2)),1)])):J("",!0),t("div",{class:"buttons-container"},[e[31]||(e[31]=t("button",{type:"submit",class:"action-btn update-btn"},"Update Stream",-1)),t("button",{type:"button",onClick:G,class:"action-btn cancel-btn"},"Cancel")])],32)])]))}},De=N(xe,[["__scopeId","data-v-c0a2993c"]]);export{De as default};
